# Migration `20200923174407-initial-migration`

This migration has been generated by Edward Hails at 9/23/2020, 6:44:07 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "User" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "username" TEXT NOT NULL,
    "passHash" TEXT NOT NULL,
    "latitude" REAL,
    "longitude" REAL
)

CREATE TABLE "Device" (
    "id" TEXT NOT NULL,
    "name" TEXT,
    "ownerId" INTEGER NOT NULL,
    "latitude" REAL,
    "longitude" REAL,

    FOREIGN KEY ("ownerId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY ("id")
)

CREATE TABLE "DataEntry" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "timestamp" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "deviceId" TEXT NOT NULL,
    "waterTemp" REAL,
    "airTemp" REAL,
    "humidity" REAL,
    "light" REAL,
    "ph" REAL,
    "rssi" REAL,

    FOREIGN KEY ("deviceId") REFERENCES "Device"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Bed" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "dataEntryId" INTEGER NOT NULL,
    "status" INTEGER,
    "level" REAL,

    FOREIGN KEY ("dataEntryId") REFERENCES "DataEntry"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Group" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL
)

CREATE TABLE "UnregisteredDevice" (
    "id" TEXT NOT NULL,
    "online" DATETIME NOT NULL,
PRIMARY KEY ("id")
)

CREATE TABLE "_GroupToUser" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL,

    FOREIGN KEY ("A") REFERENCES "Group"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("B") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "_DeviceToGroup" (
    "A" TEXT NOT NULL,
    "B" INTEGER NOT NULL,

    FOREIGN KEY ("A") REFERENCES "Device"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("B") REFERENCES "Group"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE UNIQUE INDEX "User.username_unique" ON "User"("username")

CREATE UNIQUE INDEX "_GroupToUser_AB_unique" ON "_GroupToUser"("A", "B")

CREATE INDEX "_GroupToUser_B_index" ON "_GroupToUser"("B")

CREATE UNIQUE INDEX "_DeviceToGroup_AB_unique" ON "_DeviceToGroup"("A", "B")

CREATE INDEX "_DeviceToGroup_B_index" ON "_DeviceToGroup"("B")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200923174407-initial-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,64 @@
+datasource db {
+  provider = ["sqlite", "postgresql"]
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id          Int         @default(autoincrement()) @id
+  username    String      @unique
+  passHash    String
+  latitude    Float?
+  longitude   Float?
+  devices     Device[]
+  groups      Group[]
+}
+
+model Device {
+  id          String      @id
+  name        String?
+  owner       User        @relation(fields: [ownerId], references: [id])
+  ownerId     Int
+  groups      Group[]
+  latitude    Float?
+  longitude   Float?
+  data        DataEntry[]
+}
+
+model DataEntry {
+  id          Int         @default(autoincrement()) @id
+  timestamp   DateTime    @default(now())
+  device      Device      @relation(fields: [deviceId], references: [id])
+  deviceId    String
+
+  waterTemp   Float?
+  airTemp     Float?
+  humidity    Float?
+  light       Float?
+  ph          Float?
+  rssi        Float?
+  beds        Bed[]
+}
+
+model Bed {
+  id          Int         @default(autoincrement()) @id
+  dataEntry   DataEntry   @relation(fields: [dataEntryId], references: [id])
+  dataEntryId Int
+  status      Int?
+  level       Float?
+}
+
+model Group {
+  id          Int         @default(autoincrement()) @id
+  name        String
+  members     User[]
+  devices     Device[]
+}
+
+model UnregisteredDevice {
+  id          String      @id
+  online      DateTime
+}
```


